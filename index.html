<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <?!= include('Stylesheet'); ?>
</head>
<body class="bg-light">

  <div id="alertContainer" class="position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 1060; width: 90%; max-width: 500px;"></div>

  <div id="loader" class="loading-overlay">
    <div class="spinner-border text-primary" role="status"></div>
    <div class="mt-2 fw-bold">Memproses Data...</div>
  </div>

  <div id="authContainer" class="auth-wrapper">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5 col-xl-4">
          
          <div class="card auth-card shadow-lg">
            <div class="card-body p-4 p-md-5">
              
              <div class="text-center mb-4">
                <div class="auth-icon mb-3">
                  <i class="fas fa-school fa-2x text-white"></i>
                </div>
                <h4 class="fw-bold text-dark">SISTEM LPJ BOS</h4>
                <p class="text-muted small">Kelola laporan keuangan sekolah dengan mudah</p>
              </div>

              <ul class="nav nav-pills nav-fill mb-4 p-1 bg-light rounded-pill" role="tablist">
                <li class="nav-item">
                  <button class="nav-link active rounded-pill fw-bold" id="btnTabLogin" onclick="switchAuth('login')">Masuk</button>
                </li>
                <li class="nav-item">
                  <button class="nav-link rounded-pill fw-bold" id="btnTabReg" onclick="switchAuth('register')">Daftar</button>
                </li>
              </ul>

              <form id="formLogin" class="auth-form" onsubmit="handleLogin(event)">
                
                <div class="form-floating mb-3">
                  <input type="email" name="email" class="form-control" id="loginEmail" placeholder="name@example.com" required>
                  <label for="loginEmail"><i class="fas fa-envelope me-2"></i>Email Address</label>
                </div>
                
                <div class="form-floating mb-4">
                  <input type="password" name="password" class="form-control" id="loginPass" placeholder="Password" required>
                  <label for="loginPass"><i class="fas fa-lock me-2"></i>Password</label>
                </div>

                <button type="submit" class="btn btn-primary w-100 py-3 rounded-pill fw-bold btn-animate">
                  MASUK APLIKASI <i class="fas fa-arrow-right ms-2"></i>
                </button>
              </form>

              <form id="formRegister" class="auth-form hidden" onsubmit="handleRegister(event)">
                
                <div class="form-floating mb-3">
                  <input type="text" name="npsn" class="form-control" id="regNpsn" placeholder="NPSN" required pattern="[0-9]+" title="Hanya angka">
                  <label for="regNpsn"><i class="fas fa-id-card me-2"></i>NPSN Sekolah</label>
                </div>

                <div class="form-floating mb-3">
                  <input type="text" name="sekolah" class="form-control" id="regSekolah" placeholder="Nama Sekolah" required>
                  <label for="regSekolah"><i class="fas fa-building me-2"></i>Nama Sekolah</label>
                </div>
                
                <div class="input-group mb-3">
                  <div class="form-floating flex-grow-1">
                    <input type="email" id="regEmail" name="email" class="form-control" placeholder="Email Aktif" required style="border-radius: 0.5rem 0 0 0.5rem;">
                    <label for="regEmail"><i class="fas fa-envelope me-2"></i>Email Aktif</label>
                  </div>
                  <button type="button" class="btn btn-dark px-3" onclick="requestOtp()" id="btnKirimOtp" style="border-radius: 0 0.5rem 0.5rem 0;">
                    Kirim OTP
                  </button>
                </div>

                <div class="form-floating mb-3 hidden scale-in" id="divOtpInput">
                  <input type="text" name="otp_code" class="form-control border-success bg-soft-success" id="regOtp" placeholder="Kode OTP">
                  <label for="regOtp" class="text-success fw-bold"><i class="fas fa-key me-2"></i>Masukkan Kode OTP</label>
                </div>

                <div class="form-floating mb-4">
                  <input type="password" name="password" class="form-control" id="regPass" placeholder="Password" required>
                  <label for="regPass"><i class="fas fa-lock me-2"></i>Password Baru</label>
                </div>
                
                <button type="submit" class="btn btn-success w-100 py-3 rounded-pill fw-bold btn-animate" id="btnDaftarFinal" disabled>
                  BUAT AKUN SEKARANG
                </button>
              </form>

              <div class="text-center mt-4">
                <small class="text-muted">&copy; 2025 Sistem LPJ BOS Terpadu</small>
              </div>

            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="d-flex hidden" id="wrapper">
    <div class="bg-dark text-white border-end" id="sidebar-wrapper" style="width:250px;">
      <div class="sidebar-heading border-bottom bg-primary">LPJ BOS v1.0</div>
      <div class="p-3 border-bottom">
        <small class="text-white-50">Login sebagai:</small><br>
        <strong id="displaySekolah">Nama Sekolah</strong>
      </div>
      <div class="list-group list-group-flush mt-2">
        <button class="sidebar-btn" onclick="openView('dashboard')"><i class="fas fa-home"></i> Dashboard</button>
        <button class="sidebar-btn" onclick="openView('sekolah')"><i class="fas fa-school"></i> Data Sekolah</button>
        <button class="sidebar-btn" onclick="openView('master')"><i class="fas fa-database"></i> Data Master</button>
        <button class="sidebar-btn" onclick="openView('transaksi')"><i class="fas fa-shopping-cart"></i> Input Transaksi</button>
        <button class="sidebar-btn" onclick="openView('pengaturan')"><i class="fas fa-cogs"></i> Pengaturan Cetak</button>
        <button class="sidebar-btn" onclick="openView('cetak')"><i class="fas fa-print"></i> Cetak Laporan</button>
        <button class="sidebar-btn text-danger mt-4" onclick="confirmLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
    </div>

    <div id="page-content-wrapper">
      <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
        <div class="container-fluid">
          <button class="btn btn-primary" id="sidebarToggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
        </div>
      </nav>

      <div class="container-fluid p-4">
        
        <div id="view-dashboard" class="app-view">
          <h3>Ringkasan Keuangan</h3>
          <div class="row mt-4">
            <div class="col-md-3">
              <div class="card text-white bg-primary mb-3 shadow">
                <div class="card-header">Total Anggaran</div>
                <div class="card-body"><h4 class="card-title" id="dashAnggaran">Rp. 0</h4></div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card text-white bg-warning mb-3 shadow">
                <div class="card-header">Total Belanja</div>
                <div class="card-body"><h4 class="card-title" id="dashBelanja">Rp. 0</h4></div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card text-white bg-success mb-3 shadow" id="cardSisa">
                <div class="card-header">Sisa Anggaran</div>
                <div class="card-body"><h4 class="card-title" id="dashSisa">Rp. 0</h4></div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card text-white bg-info mb-3 shadow">
                <div class="card-header">Jumlah Transaksi</div>
                <div class="card-body"><h4 class="card-title" id="dashCount">0</h4></div>
              </div>
            </div>
          </div>
        </div>

        <div id="view-sekolah" class="app-view hidden">
          <div class="card shadow">
            <div class="card-header bg-primary text-white">Identitas Sekolah</div>
            <div class="card-body">
              <form id="formSekolah" onsubmit="simpanSekolah(event)">
                <div class="row">
                  <div class="col-12 mb-3">
                    <label class="fw-bold">Total Anggaran (1 Tahun)</label>
                    <div class="input-group">
                      <span class="input-group-text">Rp</span>
                      <input type="number" name="total_anggaran" class="form-control" placeholder="Contoh: 50000000">
                    </div>
                    <small class="text-muted">Masukkan angka saja tanpa titik/koma.</small>
                  </div>
                  <hr>
                  <div class="col-md-6 mb-3"><label>Nama Kepala Sekolah</label><input type="text" name="kepsek" class="form-control"></div>
                  <div class="col-md-6 mb-3"><label>NIP Kepala Sekolah</label><input type="text" name="nip_kepsek" class="form-control"></div>
                  <div class="col-md-6 mb-3"><label>Nama Bendahara</label><input type="text" name="bendahara" class="form-control"></div>
                  <div class="col-md-6 mb-3"><label>NIP Bendahara</label><input type="text" name="nip_bendahara" class="form-control"></div>
                  
                  <div class="col-12 mb-3">
                    <label>Alamat TTD (Tempat/Kota)</label>
                    <input type="text" name="alamat_ttd" class="form-control" placeholder="Contoh: Bulukumba">
                    <small class="text-muted">* Kota/Kabupaten tempat penandatanganan dokumen.</small>
                  </div>

                </div>
                <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
              </form>
            </div>
          </div>
        </div>

        <div id="view-transaksi" class="app-view hidden">
          <h3 id="titleTrx">Input Transaksi Belanja</h3>
          
          <form id="formTrx" onsubmit="simpanTransaksi(event)">
            <input type="hidden" id="trxIdEdit" name="id_trx_edit">

            <div class="card mb-3 shadow-sm">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs">
                        <li class="nav-item"><button class="nav-link active" id="tabBelanja" type="button" onclick="switchTrxMode('belanja')">Belanja (Toko)</button></li>
                        <li class="nav-item"><button class="nav-link" id="tabTukang" type="button" onclick="switchTrxMode('tukang')">Jasa (Tukang)</button></li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                      <div class="col-md-2"> <label class="form-label">Tanggal</label>
                          <input type="date" name="tanggal" id="trxTanggal" class="form-control" required>
                      </div>
                      
                      <div class="col-md-3">
                          <label class="form-label">Nama Pemesan</label>
                          <select name="pemesan" class="form-select" id="trxPemesan" required>
                              <option value="">Pilih Pemesan...</option>
                          </select>
                      </div>
                      <div class="col-md-3"> <label class="form-label" id="lblPihak">Toko</label>
                          <select name="toko" class="form-select" id="trxPihak" required>
                              <option value="">Pilih...</option>
                          </select>
                      </div>

                      <div class="col-md-4"> <label class="form-label">Uraian</label>
                          <select name="uraian" class="form-select" id="trxUraian" required>
                              <option value="">Pilih Uraian...</option>
                          </select>
                      </div>
                    </div>
                </div>
            </div>
            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <table class="table table-bordered mb-0">
                        <thead class="table-light"><tr><th>Barang</th><th width="80">Vol</th><th width="80">Sat</th><th>Harga</th><th>Total</th><th>#</th></tr></thead>
                        <tbody id="trxBody"></tbody>
                        <tfoot class="table-light"><tr><td colspan="4" class="text-end fw-bold">TOTAL:</td><td class="fw-bold" id="grandTotal">0</td><td></td></tr></tfoot>
                    </table>
                </div>
                <div class="card-footer">
                    <button type="button" class="btn btn-success btn-sm" onclick="addRow()">+ Item</button>
                    <div class="float-end">
                        <button type="button" class="btn btn-secondary btn-sm me-2 hidden" id="btnBatalEdit" onclick="cancelEditMode()">Batal Edit</button>
                        <button type="submit" class="btn btn-primary btn-sm" id="btnSimpanTrx">SIMPAN</button>
                    </div>
                </div>
            </div>
          </form>

          <div class="card mt-4 shadow-sm border-0">
            <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
              <span><i class="fas fa-history"></i> Riwayat Input Terakhir</span>
              <button class="btn btn-sm btn-light py-0" onclick="loadRiwayat()"><i class="fas fa-sync"></i> Refresh</button>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-striped table-hover mb-0" id="tableRiwayat">
                    <thead class="table-light"><tr><th>Tanggal</th><th>Toko / Pihak</th><th>Uraian</th><th style="min-width: 300px;">Detail Barang</th><th class="text-end">Total</th><th class="text-center">Aksi</th></tr></thead>
                    <tbody id="tbody_riwayat"><tr><td colspan="6" class="text-center p-3">Memuat data...</td></tr></tbody>
                  </table>
                </div>
            </div>
          </div>
        </div>

        <div id="view-pengaturan" class="app-view hidden">
            <h3>Pengaturan Cetak</h3>
            <div class="card shadow-sm mt-3">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="settingTabs">
                        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-kop">Kop Surat</button></li>
                        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-nomor" onclick="loadPengaturanNomor()">Nomor Surat</button></li>
                        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-tanggal" onclick="loadPengaturanTanggal()">Pengaturan Tanggal</button></li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="tab-kop">
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Upload Kop Surat (JPG/PNG)</label>
                                    <input type="file" id="fileKop" class="form-control mb-3" accept="image/*" onchange="previewKop(this)">
                                    <button class="btn btn-primary" onclick="uploadKopSurat()">Simpan Kop Surat</button>
                                </div>
                                <div class="col-md-6 text-center">
                                    <label class="form-label text-muted">Preview:</label>
                                    <div class="border p-2 bg-light" style="min-height: 150px;">
                                        <img id="previewImgKop" src="" class="img-fluid" style="max-height: 200px; display:none;">
                                        <p id="noKopText" class="text-muted mt-5">Belum ada kop surat</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="tab-nomor">
                             <div class="alert alert-info py-2"><small><i class="fas fa-info-circle"></i> Klik tombol "Input No" pada transaksi untuk melengkapi nomor surat.</small></div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover mb-0">
                                    <thead class="table-dark"><tr><th>Tanggal</th><th>Pihak (Toko/Tukang)</th><th>Uraian</th><th class="text-center">Status Nomor</th><th class="text-center">Aksi</th></tr></thead>
                                    <tbody id="tbody_setting_nomor"><tr><td colspan="5" class="text-center">Memuat data...</td></tr></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="tab-tanggal">
                            <div class="alert alert-warning py-2"><small><i class="fas fa-calendar-alt"></i> Atur tanggal dokumen pendukung di sini.</small></div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover mb-0">
                                    <thead class="table-dark">
                                        <tr><th>Tgl Trx</th><th>Pihak</th><th>Uraian</th><th class="text-center">Status</th><th class="text-center">Aksi</th></tr>
                                    </thead>
                                    <tbody id="tbody_setting_tanggal"><tr><td colspan="5" class="text-center">Klik tab ini untuk memuat data...</td></tr></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="view-master" class="app-view hidden">
          <h3 class="mb-4 border-bottom pb-2"><i class="fas fa-database text-primary"></i> Kelola Data Master</h3>
          
          <ul class="nav nav-pills mb-3" id="masterTabs" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-uraian" type="button" onclick="loadMasterTable('Data_Uraian')"><i class="fas fa-list"></i> Uraian Belanja</button></li>
            <li class="nav-item ms-2"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-toko" type="button" onclick="loadMasterTable('Data_Toko')"><i class="fas fa-store"></i> Data Toko</button></li>
            <li class="nav-item ms-2"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-tukang" type="button" onclick="loadMasterTable('Data_Tukang')"><i class="fas fa-user-hard-hat"></i> Data Tukang</button></li>
            <li class="nav-item ms-2"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-guru" type="button" onclick="loadMasterTable('Data_Guru'); initGuruInput();"><i class="fas fa-chalkboard-teacher"></i> Data Guru/Pemesan</button></li>
          </ul>

          <div class="tab-content">
            
            <div class="tab-pane fade show active" id="tab-uraian">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card form-card-modern">
                            <div class="card-header bg-primary text-white fw-bold">Form Uraian</div>
                            <div class="card-body">
                                <form onsubmit="simpanMaster(event, 'Data_Uraian')">
                                    <input type="hidden" name="rowIndex" id="idx_Data_Uraian">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Nomor Bukti</label>
                                        <input type="text" name="kode" id="u_kode" class="form-control" placeholder="Contoh: 001/BOS/....">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Nama Uraian</label>
                                        <input type="text" name="nama" id="u_nama" class="form-control" placeholder="Contoh: Belanja ATK" required>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary" id="btn_Data_Uraian"><i class="fas fa-save"></i> Simpan</button>
                                        <button type="button" class="btn btn-secondary hidden" id="cancel_Data_Uraian" onclick="resetFormMaster('Data_Uraian')">Batal</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="master-table-scroll">
                            <table class="table table-striped table-hover mb-0">
                                <thead class="table-primary text-white">
                                    <tr><th>No. Bukti</th><th>Nama Uraian</th><th style="width:100px;">Aksi</th></tr>
                                </thead>
                                <tbody id="tbody_Data_Uraian"></tbody>
                            </table>
                        </div>
                        <small class="text-muted fst-italic mt-1 d-block">* Tabel dapat discroll ke bawah.</small>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-toko">
                 <div class="row">
                    <div class="col-md-5 mb-3">
                        <div class="card form-card-modern">
                            <div class="form-header-modern">
                                <span><i class="fas fa-store me-2"></i> Form Data Toko</span>
                            </div>
                            <div class="card-body p-4">
                                <form onsubmit="simpanMaster(event, 'Data_Toko')">
                                    <input type="hidden" name="rowIndex" id="idx_Data_Toko">
                                    
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-8">
                                            <label class="form-label fw-bold text-secondary small">Nama Toko</label>
                                            <input type="text" name="nama" id="t_nama" class="form-control" placeholder="Nama Toko Lengkap" required>
                                        </div>

                                        <div class="col-md-4">
                                            <label class="form-label fw-bold text-secondary small">Jenis</label>
                                            <select name="jenis" id="t_jenis" class="form-select" onchange="toggleJenisLainnya()">
                                                <option value="ATK">ATK</option>
                                                <option value="Bangunan">Bangunan</option>
                                                <option value="Elektronik">Elektronik</option>
                                                <option value="Konsumsi">Konsumsi</option>
                                                <option value="Lainnya">Lainnya</option>
                                            </select>
                                        </div>

                                        <div class="col-12 hidden" id="div_jenis_manual">
                                            <label class="form-label fw-bold text-secondary small">Ketik Jenis Toko (Manual)</label>
                                            <input type="text" id="t_jenis_manual" class="form-control border-warning" placeholder="Contoh: Fotocopy / Jasa Servis / Lainnya..." style="background-color: #fffdf5;">
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold text-secondary small">Alamat Lengkap</label>
                                        <textarea name="alamat" id="t_alamat" class="form-control" placeholder="Jl. Raya..." rows="2"></textarea>
                                    </div>

                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold text-secondary small">No. Telepon (Teks)</label>
                                            <input type="text" name="telp" id="t_telp" class="form-control" placeholder="08xx / (021) xxx">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold text-secondary small">Nama Pemilik</label>
                                            <input type="text" name="pemilik" id="t_pemilik" class="form-control" placeholder="Nama Pemilik">
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label fw-bold text-secondary small">Tempat TTD (Kwitansi/Nota)</label>
                                        <input type="text" name="tempat" id="t_tempat" class="form-control" placeholder="Contoh: Makassar">
                                        <div class="form-text text-muted" style="font-size: 0.75rem;">* Kota/Lokasi transaksi (bukan Tanggal).</div>
                                    </div>

                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <button type="button" class="btn btn-outline-secondary hidden flex-fill" id="cancel_Data_Toko" onclick="resetFormMaster('Data_Toko')">Batal</button>
                                        <button type="submit" class="btn btn-primary flex-fill fw-bold shadow-sm" id="btn_Data_Toko"><i class="fas fa-check-circle"></i> Simpan Toko</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-7">
                        <div class="master-table-scroll">
                            <table class="table table-striped table-hover mb-0" style="font-size:0.9rem">
                                <thead class="table-success">
                                    <tr>
                                        <th>Identitas Toko</th>
                                        <th>Alamat & Kontak</th>
                                        <th>Pemilik</th>
                                        <th style="width:80px;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="tbody_Data_Toko"></tbody>
                            </table>
                        </div>
                        <div class="mt-2 text-end text-muted small">
                            <i class="fas fa-info-circle"></i> Gunakan scroll di dalam tabel untuk melihat data lainnya.
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-tukang">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card form-card-modern">
                            <div class="card-header bg-warning text-dark fw-bold">Form Tukang</div>
                            <div class="card-body">
                                <form onsubmit="simpanMaster(event, 'Data_Tukang')">
                                    <input type="hidden" name="rowIndex" id="idx_Data_Tukang">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Nama Tukang</label>
                                        <input type="text" name="nama" id="k_nama" class="form-control" placeholder="Nama Lengkap" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Alamat</label>
                                        <textarea name="alamat" id="k_alamat" class="form-control" placeholder="Alamat Domisili" rows="3"></textarea>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-warning" id="btn_Data_Tukang"><i class="fas fa-save"></i> Simpan Tukang</button>
                                        <button type="button" class="btn btn-secondary hidden" id="cancel_Data_Tukang" onclick="resetFormMaster('Data_Tukang')">Batal</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="master-table-scroll">
                            <table class="table table-striped table-hover mb-0">
                                <thead class="table-warning">
                                    <tr><th>Nama Tukang</th><th>Alamat</th><th style="width:100px;">Aksi</th></tr>
                                </thead>
                                <tbody id="tbody_Data_Tukang"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-guru">
                <div class="row">
                    <div class="col-md-5 mb-3">
                        <div class="card form-card-modern">
                            <div class="card-header bg-success text-white fw-bold d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-plus-circle me-2"></i> Input Data Guru</span>
                                <button class="btn btn-sm btn-light text-success fw-bold" onclick="addGuruRow()">+ Baris</button>
                            </div>
                            <div class="card-body p-0">
                                <div id="mode_input_guru_bulk">
                                    <form onsubmit="simpanGuruBulk(event)">
                                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                            <table class="table table-bordered mb-0 table-sm">
                                                <thead class="table-light sticky-top">
                                                    <tr>
                                                        <th>Nama Lengkap (Wajib)</th>
                                                        <th>NIP (Opsional)</th>
                                                        <th width="40px"></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbody_input_guru">
                                                    </tbody>
                                            </table>
                                        </div>
                                        <div class="p-3 d-grid">
                                            <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Simpan Semua</button>
                                        </div>
                                    </form>
                                </div>

                                <div id="mode_input_guru_single" class="hidden p-3">
                                    <div class="alert alert-warning py-1 small mb-2">Mode Edit Data</div>
                                    <form onsubmit="simpanMaster(event, 'Data_Guru')">
                                        <input type="hidden" name="rowIndex" id="idx_Data_Guru">
                                        <div class="mb-2">
                                            <label class="form-label small fw-bold">Nama Lengkap</label>
                                            <input type="text" name="nama" id="g_nama" class="form-control form-control-sm" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label small fw-bold">NIP</label>
                                            <input type="text" name="nip" id="g_nip" class="form-control form-control-sm" placeholder="Opsional">
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-warning btn-sm" id="btn_Data_Guru">Update Data</button>
                                            <button type="button" class="btn btn-secondary btn-sm" id="cancel_Data_Guru" onclick="resetFormMaster('Data_Guru')">Batal / Kembali ke Input</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-7">
                        <div class="master-table-scroll">
                            <table class="table table-striped table-hover mb-0">
                                <thead class="table-success">
                                    <tr><th>Nama Guru/Pemesan</th><th>NIP</th><th style="width:100px;">Aksi</th></tr>
                                </thead>
                                <tbody id="tbody_Data_Guru"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
          </div>
        </div>
        
        <div id="view-cetak" class="app-view hidden">
            <h3 class="mb-3"><i class="fas fa-print"></i> Cetak Laporan Lengkap</h3>
            <div class="alert alert-info">
                <small><i class="fas fa-info-circle"></i> Fitur ini akan mencetak 7 halaman sekaligus: Surat Keluar, Penawaran, BA Pemeriksaan, BA Serah Terima, Faktur, BA Pembayaran, dan Kwitansi.</small>
            </div>
            <div class="card shadow">
                <div class="card-header bg-dark text-white">Daftar Transaksi Siap Cetak</div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <thead class="table-secondary">
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Toko / Pihak</th>
                                    <th>Uraian Belanja</th>
                                    <th class="text-end">Total</th>
                                    <th class="text-center" width="150">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tbody_cetak">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

      </div>
    </div>
  </div>

  <div class="modal fade" id="modalNomorSurat" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Input Nomor Surat</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formNomorSurat" onsubmit="simpanNomorSurat(event)">
                    <input type="hidden" name="id_trx" id="ns_id_trx">
                    <input type="hidden" id="ns_jenis_pihak"> <div class="mb-3">
                        <label class="fw-bold">1. Nomor Surat Keluar (Madrasah/Sekolah)</label>
                        <input type="text" name="no_keluar" id="ns_keluar" class="form-control" placeholder="Contoh: 001/Mts.01/.../2025">
                    </div>
                    <div class="mb-3" id="div_ns_masuk">
                        <label class="fw-bold">2. Nomor Surat Masuk / Nota (Dari Toko)</label>
                        <input type="text" name="no_masuk" id="ns_masuk" class="form-control" placeholder="Nomor Nota/Faktur">
                        <small class="text-muted">* Kosongkan jika Pihak adalah Tukang</small>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label class="fw-bold">3. No. BA Pemeriksaan <span id="lbl_ns_periksa">Barang</span></label><input type="text" name="no_periksa" id="ns_periksa" class="form-control"></div>
                        <div class="col-md-6 mb-3"><label class="fw-bold">4. No. BA Serah Terima <span id="lbl_ns_terima">Barang</span></label><input type="text" name="no_terima" id="ns_terima" class="form-control"></div>
                    </div>
                    <div class="mb-3"><label class="fw-bold">5. Nomor BA Pembayaran</label><input type="text" name="no_bayar" id="ns_bayar" class="form-control"></div>
                    <div class="modal-footer px-0 pb-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-success">Simpan Nomor</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
  </div>

  <div class="modal fade" id="modalTanggalSurat" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title">Set Tanggal Dokumen</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formTanggalSurat" onsubmit="simpanTanggalSurat(event)">
                    <input type="hidden" name="id_trx" id="ts_id_trx">
                    <input type="hidden" id="ts_jenis_pihak"> <div class="mb-3" id="div_ts_masuk">
                        <label class="fw-bold">1. Tanggal Nota/Faktur (Dari Toko)</label>
                        <input type="date" name="tgl_masuk" id="ts_masuk" class="form-control">
                        <small class="text-muted">* Kosongkan jika Pihak adalah Tukang</small>
                    </div>
                    <div class="mb-3"><label class="fw-bold">2. Tanggal BA Pemeriksaan <span id="lbl_ts_periksa">Barang</span></label><input type="date" name="tgl_periksa" id="ts_periksa" class="form-control"></div>
                    <div class="mb-3"><label class="fw-bold">3. Tanggal BA Serah Terima <span id="lbl_ts_terima">Barang</span></label><input type="date" name="tgl_terima" id="ts_terima" class="form-control"></div>
                    <div class="mb-3"><label class="fw-bold">4. Tanggal BA Pembayaran</label><input type="date" name="tgl_bayar" id="ts_bayar" class="form-control"></div>
                    <div class="modal-footer px-0 pb-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-warning">Simpan Tanggal</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
  </div>

  <div class="modal fade" id="modalKonfirmasi" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Konfirmasi</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p id="txtKonfirmasi" class="fs-5">Apakah Anda yakin?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-danger" id="btnYaKonfirmasi">Ya, Lanjutkan</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalPilihCetak" tabindex="-1">
    <div class="modal-dialog modal-sm modal-dialog-centered"> 
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="fas fa-print"></i> Opsi Cetak</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="cetak_id_trx"> <div class="mb-3">
                    <label class="form-label fw-bold small text-muted">Pilih Dokumen yang Dicetak:</label>
                    <select id="cetak_jenis" class="form-select">
                        <option value="all" selected>Semua (Lengkap 7 Hal)</option>
                        <option value="1">1. Surat Permintaan</option>
                        <option value="2">2. Surat Penawaran</option>
                        <option value="3">3. BA Pemeriksaan</option>
                        <option value="4">4. BA Serah Terima</option>
                        <option value="5">5. Faktur / Nota</option>
                        <option value="6">6. BA Pembayaran</option>
                        <option value="7">7. Kwitansi</option>
                    </select>
                </div>
                
                <div class="d-grid">
                    <button type="button" class="btn btn-danger fw-bold" onclick="prosesCetakPDF()">
                        <i class="fas fa-file-pdf"></i> DOWNLOAD PDF
                    </button>
                </div>
            </div>
        </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <?!= include('JavaScript'); ?>
</body>
</html>
